<polymer-element name="optime-frame">
  <template>
    <style>
    /* TODO: Why */
    core-header-panel {
      height: 64px;
      z-index: 10;
    }
    core-toolbar {
      /* Cyan 500 */
      background-color: #00BCD4;
    }
    :host #navbar {
      color: white;

      position: absolute;
      top: 0px;
      width: 100%;
    }

    :host([optime-still]) #navbar {
      position: fixed;
      top: 0;
    }

    #toolbarTitle {
      font-size: 1.25em;
      font-weight: bold;
    }

    #main-panel {
      padding: 64px 0 20px 0;
      margin: 0;
      background-color: #E0F7FA; /* Cyan 50 */
      overflow-x: hidden;
      transition: background-color 0.2s ease-in-out;
    }

    @media screen and (max-width: 429px) {
      #main-panel{
        padding-bottom: 0;
        background-color: #EEEEEE; /* Grey 200 */
      }
    }

    #drawer-panel {
      background-color: white;
    }

    core-drawer-panel::shadow #scrim {
      z-index: 50;
    }

    core-drawer-panel::shadow #drawer {
      z-index: 100;
    }
    </style>
    <core-drawer-panel forceNarrow="true">
      <div id="drawer-panel" drawer>
      </div>
      <div id="main-panel" main>
        <core-header-panel id="navbar" flex>
          <core-toolbar id="toolbar">
            <paper-icon-button id="toolbarMenu" icon="menu" on-tap="{{menuAction}}" core-drawer-toggle></paper-icon-button>
            <div id="toolbarTitle" flex>{{ pageTitle }}</div>
            <paper-icon-button id="toolbarAdd" icon="add" on-tap="{{menuAdd}}"></core-icon-button>
          </core-toolbar>
        </core-header-panel>
        <div id="card-set">
          <content></content>
        </div>
      </div>
    </core-drawer-panel>
  </template>
  <script>
    Polymer({
      cardCount: 0,
      pageTitle: "Loading...",
      menuAction: function(e) {
      },
      menuAdd: function(e) {
        var hintCard = document.createElement("optime-card");
        var hintTitleNode = document.createElement("h1");
        hintTitleNode.appendChild(document.createTextNode("Optime"));
        var hintPara1 = document.createElement("p");
        hintPara1.appendChild(document.createTextNode("It's working in progress."));
        var hintPara2 = document.createElement("p");
        hintPara2.appendChild(document.createTextNode("For futher information, please log in to "));
        var hintLink = document.createElement("a");
        hintLink.setAttribute("href","http://op-ti.me");
        hintLink.appendChild(document.createTextNode("op-ti.me"));
        hintPara2.appendChild(hintLink);
        hintPara2.appendChild(document.createTextNode(" to explore more."));
        hintCard.appendChild(hintTitleNode);
        hintCard.appendChild(hintPara1);
        hintCard.appendChild(hintPara2);

        hintCard.dismissable=true;
        hintCard.acceptable=false;
        hintCard.dismissText="Got it";
        hintCard.setAttribute("wide","");

        meta = document.createElement('core-meta');
        meta.type='transition';
        meta.byId("optime-card-fade").setup(hintCard);

        this.insertCard(hintCard);
      },

      insertCard: function(card,position) {
        position = (typeof position !== 'undefined') ? position : 0;
        if(position < 0 || position > this.cardCount) throw { name: "optime:frame:invalidPosition", message: "Invalid card position: "+position};
        else {
          var inserted;
          if(position == this.cardCount) inserted=this.appendChild(card);
          else inserted=this.insertBefore(card,this.children[position]);
          this.cardCount += 1;

          /* Wait the templates to initialize
           * Or the calculated height will be incorrect 
           */
          window.setTimeout(function() {
            inserted.show();
          },0);

          return inserted;
        }
      },

      ready: function() {
        this.cardCount = this.children.length;
      }
    });
  </script>
</polymer-element>
