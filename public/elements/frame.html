<polymer-element name="optime-frame">
  <template>
    <style>
    /* TODO: Why */
    core-header-panel {
      height: 64px;
      z-index: 10;
    }
    core-toolbar {
      /* Cyan 500 */
      background-color: #00BCD4;
    }
    :host #navbar {
      color: white;

      position: absolute;
      top: 0px;
      width: 100%;
    }

    :host([optime-still]) #navbar {
      position: fixed;
      top: 0;
    }

    #toolbar-title {
      font-size: 1.25em;
      font-weight: bold;
    }

    #main-panel {
      padding: 64px 0 0 0;
      margin: 0;
      background-color: #E0F7FA; /* Cyan 50 */
      overflow-x: hidden;
      transition: background-color 0.2s ease-in-out;
    }

    @media screen and (max-width: 429px) {
      #main-panel{
        background-color: #EEEEEE; /* Grey 200 */
      }
    }

    #drawer-panel {
      background-color: white;
    }

    core-drawer-panel::shadow #scrim {
      z-index: 50;
    }

    core-drawer-panel::shadow #drawer {
      z-index: 100;
    }

    #fab-add {
      position: fixed;
      bottom: 12px;
      right: 12px;
      background-color: #F44336; /* Red 500 */
      color: white;
    }

    #loading-indicator {
      color: rgba(0,0,0,0.26);
      display: block;
      height: 80px;
      line-height: 80px;
      text-align: center;
    }

    #toolbar-account {
      height: 36px;
      width: 36px;
      border-radius: 18px;

      margin: 0 8px;
      cursor: pointer;
    }

    #toolbar-account-avatar {
      padding: 2px;
    }

    #toolbar-account-avatar::shadow core-icon {
      width: 36px;
      height: 36px;
    }

    #toolbar-account-avatar::shadow core-icon div {
      border-radius: 50%;
    }

    [status='logged-in'] #toolbar-account-icon {
      display: none;
    }

    [status='logged-in'] #toolbar-account-avatar {
      display: block;
    }

    [status='logged-out'] #toolbar-account-icon {
      display: block;
    }

    [status='logged-out'] #toolbar-account-avatar {
      display: none;
    }

    </style>
    <core-drawer-panel forceNarrow="true">
      <div id="drawer-panel" drawer>
      </div>
      <div id="main-panel" main>
        <core-header-panel id="navbar" flex>
          <core-toolbar id="toolbar" status="{{loggedIn ? 'logged-in' : 'logged-out'}}">

            <paper-icon-button id="toolbar-drawer" icon="menu" on-tap="{{drawerAction}}" core-drawer-toggle></paper-icon-button>
            <div id="toolbar-title" flex>{{ pageTitle }}</div>

            <paper-icon-button id="toolbar-account-icon" icon="account-circle" on-tap="{{loginAction}}"></paper-icon-button>
            <paper-icon-button id="toolbar-account-avatar" src="{{ userAvatarLink }}" on-tap="{{accountAction}}"></paper-icon-button>

          </core-toolbar>
        </core-header-panel>
        <div id="card-set">
          <content></content>
          <div id="loading-indicator">No more task</div>
        </div>
        <paper-fab id="fab-add" icon="add" on-tap="{{fabAdd}}"></paper-fab>
      </div>
    </core-drawer-panel>
  </template>
  <script>
    Polymer({
      cardCount: 0,
      pageTitle: "Loading...",

      loggedIn: false,
      username: "CircuitCoder",
      userAvatarLink: "http://www.gravatar.com/avatar/029df89b7e24e1a99b717230e0733bbf.png",

      drawerAction: function(e) {},
      accountAction: function(e) {
        this.loggedIn=!this.loggedIn;
      },
      fabAdd: function(e) {
        var hintCard = document.createElement("optime-card");
        var hintTitleNode = document.createElement("h1");
        hintTitleNode.appendChild(document.createTextNode("Optime"));
        var hintPara1 = document.createElement("p");
        hintPara1.appendChild(document.createTextNode("It's working in progress."));
        var hintPara2 = document.createElement("p");
        hintPara2.appendChild(document.createTextNode("For futher information, please log in to "));
        var hintLink = document.createElement("a");
        hintLink.setAttribute("href","http://op-ti.me");
        hintLink.appendChild(document.createTextNode("op-ti.me"));
        hintPara2.appendChild(hintLink);
        hintPara2.appendChild(document.createTextNode(" to explore more."));
        hintCard.appendChild(hintTitleNode);
        hintCard.appendChild(hintPara1);
        hintCard.appendChild(hintPara2);

        hintCard.dismissable=true;
        hintCard.acceptable=false;
        hintCard.dismissText="Got it";
        hintCard.setAttribute("wide","");

        meta = document.createElement('core-meta');
        meta.type='transition';
        meta.byId("optime-card-fade").setup(hintCard);

        this.insertCard(hintCard);
      },

      insertCard: function(card,position) {
        position = (typeof position !== 'undefined') ? position : 0;
        if(position < 0 || position > this.cardCount) throw { name: "optime:frame:invalidPosition", message: "Invalid card position: "+position};
        else {
          var inserted;
          if(position == this.cardCount) inserted=this.appendChild(card);
          else inserted=this.insertBefore(card,this.children[position]);
          this.cardCount += 1;

          /* Wait the templates to initialize
           * Or the calculated height will be incorrect 
           */
          window.setTimeout(function() {
            inserted.show();
          },0);

          return inserted;
        }
      },

      ready: function() {
        this.cardCount = this.children.length;
      }
    });
  </script>
</polymer-element>
